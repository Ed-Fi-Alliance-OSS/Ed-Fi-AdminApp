name: "Copilot Setup Steps"

on:
  workflow_dispatch:
  push:
    paths:
      - .github/workflows/copilot-setup-steps.yml
  pull_request:
    paths:
      - .github/workflows/copilot-setup-steps.yml

jobs:
  copilot-setup-steps:
    runs-on: ubuntu-latest

    permissions:
      contents: read

    env:
      DATABASE_USER: sa
      DATABASE_PASSWORD: Password123!
      DATABASE_NAME: aa

    services:
      postgresql:
        image: postgres:16.2
        ports:
          - "5432:5432"
        options: >-
          --health-cmd "exit 0"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 3
          --name mssql
          --user root
        env:
          POSTGRES_USER: ${DATABASE_USER}
          POSTGRES_PASSWORD: ${DATABASE_PASSWORD}
          POSTGRES_DB: ${DATABASE_NAME}

      mssql:
        image: mcr.microsoft.com/mssql/server:2022-latest
        ports:
          - "1433:1433"
        options: >-
          --health-cmd "exit 0"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 3
          --name mssql
          --user root
        env:
          ACCEPT_EULA: Y
          MSSQL_PID: Express
          SA_PASSWORD: ${DATABASE_PASSWORD}

    steps:
      - run: echo "PostgreSQL and MSSQL are running"
